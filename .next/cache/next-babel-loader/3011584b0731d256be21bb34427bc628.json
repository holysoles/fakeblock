{"ast":null,"code":"import React from \"react\";\nimport fetch from \"node-fetch\";\nimport { Headers } from \"node-fetch\";\nimport GetFBID from \"../GetFBID\";\nexport default async function GetPosts(page) {\n  const jsdom = require(\"jsdom\");\n\n  const {\n    JSDOM\n  } = jsdom;\n  const dom = new JSDOM();\n  const document = dom.window.document;\n  let postsArray = [];\n  const fbID = await GetFBID(page);\n  const jsonUrl = 'https://www.facebook.com/pages_reaction_units/more/?'; //timeline cursor appears to set where posts get request starts from\n\n  const timelineCursor = \"%7B%22timeline_cursor%22%3A%22AQHRoDgKgwnQmRz8-7LyXTbs8467llbU4E2FkvBASG8-CkOTDUtCxL2Rbx\" + \"_u0_cGtwwSP-aOXMsTVCNr62TMoNdjl0EmuzWGBCNQrxeyKxMb4hQQMNqhGGJtLN8VYY5vIYUR%22%2C%22timeline_section_cursor%22\" + \"%3Anull%2C%22has_next_page%22%3Atrue%7D\";\n  const params = {\n    'surface': 'www_pages_posts',\n    'unit_count': '8',\n    //sets how many posts to get\n    '__a': '1'\n  };\n  const headers = new Headers({\n    'User-Agent': \"PostmanRuntime/7.24.1\"\n  });\n  const opts = {\n    method: 'GET',\n    headers: headers,\n    redirect: 'follow'\n  };\n  const fullUrl = jsonUrl + 'page_id=' + fbID + \"&cursor=\" + timelineCursor + '&' + new URLSearchParams(params);\n  console.log(fullUrl);\n  const res = await fetch(fullUrl, opts);\n\n  if (res.ok) {\n    console.log(\"response okay\"); //need to get html updates from json response\n\n    const resText = await res.text();\n    const rawJson = resText.replace(\"for (;;);\", \"\");\n    const postsJson = JSON.parse(rawJson);\n    const rawHtml = postsJson.domops[0][3].__html; //construct doc from raw html string and get post wrapper elements into html collection\n\n    const postsDoc = document.createElement('html');\n    postsDoc.innerHTML = rawHtml; //get posts elements from html doc\n\n    const postWrappers = postsDoc.getElementsByClassName(\"_5pcr userContentWrapper\"); //const postMessages = postsDoc.querySelectorAll(\"div[data-testid='post_message']\");\n\n    console.log(\"how many post containers: \", postWrappers.length);\n\n    for (let i = 0; i < postWrappers.length; i++) {\n      let post = {\n        user: '',\n        timestamp: '',\n        text: [],\n        images: [],\n        video\n      };\n      const postImages = postWrappers[i].getElementsByTagName('img');\n      const postParagraphs = postWrappers[i].getElementsByTagName('p'); //get username name, timestamp from post\n\n      const usernameWrapper = postWrappers[i].getElementsByClassName('fwb').item(0);\n      const username = usernameWrapper.textContent;\n      post.user = username;\n      const timestamp = postWrappers[i].getElementsByClassName('timestampContent')[0].textContent;\n      post.timestamp = timestamp; //if post has paragraphs, iterate over each and push to text array in post object\n\n      for (let j = 0; j < postParagraphs.length; j++) {\n        post.text.push(postParagraphs[j].textContent);\n      } //if post has images, iterate over each and push to image array in post object\n\n\n      if (postImages.length > 0) {\n        for (let k = 0; k < postImages.length; k++) {\n          const image = postImages.item(k);\n          const imagesToIgnore = \"Image may contain: possible text that says 'Shop Now'\";\n\n          if (image.getAttribute('alt') !== imagesToIgnore) {\n            post.images.push(image.getAttribute('src'));\n          }\n        }\n      } //if post has a video, grab source and set video property in post object\n\n\n      const postHasVideo = postsDoc.querySelectorAll(\"a[aria-label~='Video,']\");\n\n      if (postHasVideo.length > 0) {\n        const videoSource = postHasVideo[0].attributes.ajaxify.value;\n        const videoUrl = \"https://www.facebook.com\" + videoSource;\n        post.video = videoUrl;\n      }\n\n      postsArray.push(post);\n    }\n\n    return postsArray;\n  } else {\n    console.log(\"response failed\");\n    return [];\n  }\n}","map":{"version":3,"sources":["C:/Users/Patrick/PhpstormProjects/fakeblock/components/Business/GetPosts.js"],"names":["React","fetch","Headers","GetFBID","GetPosts","page","jsdom","require","JSDOM","dom","document","window","postsArray","fbID","jsonUrl","timelineCursor","params","headers","opts","method","redirect","fullUrl","URLSearchParams","console","log","res","ok","resText","text","rawJson","replace","postsJson","JSON","parse","rawHtml","domops","__html","postsDoc","createElement","innerHTML","postWrappers","getElementsByClassName","length","i","post","user","timestamp","images","video","postImages","getElementsByTagName","postParagraphs","usernameWrapper","item","username","textContent","j","push","k","image","imagesToIgnore","getAttribute","postHasVideo","querySelectorAll","videoSource","attributes","ajaxify","value","videoUrl"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport fetch from \"node-fetch\"\r\nimport {Headers} from \"node-fetch\";\r\nimport GetFBID from \"../GetFBID\";\r\n\r\nexport default async function GetPosts(page) {\r\n    const jsdom = require(\"jsdom\");\r\n    const {JSDOM} = jsdom;\r\n    const dom = new JSDOM();\r\n    const document = dom.window.document;\r\n    let postsArray = [];\r\n\r\n    const fbID = await GetFBID(page);\r\n    const jsonUrl = 'https://www.facebook.com/pages_reaction_units/more/?';\r\n    //timeline cursor appears to set where posts get request starts from\r\n    const timelineCursor = \"%7B%22timeline_cursor%22%3A%22AQHRoDgKgwnQmRz8-7LyXTbs8467llbU4E2FkvBASG8-CkOTDUtCxL2Rbx\" +\r\n        \"_u0_cGtwwSP-aOXMsTVCNr62TMoNdjl0EmuzWGBCNQrxeyKxMb4hQQMNqhGGJtLN8VYY5vIYUR%22%2C%22timeline_section_cursor%22\" +\r\n        \"%3Anull%2C%22has_next_page%22%3Atrue%7D\";\r\n    const params = {\r\n        'surface': 'www_pages_posts',\r\n        'unit_count': '8', //sets how many posts to get\r\n        '__a': '1'\r\n    };\r\n    const headers = new Headers({'User-Agent': \"PostmanRuntime/7.24.1\"});\r\n    const opts = {\r\n        method: 'GET',\r\n        headers: headers,\r\n        redirect: 'follow',\r\n    };\r\n    const fullUrl = jsonUrl + 'page_id=' + fbID + \"&cursor=\" + timelineCursor + '&' + new URLSearchParams(params);\r\n    console.log(fullUrl);\r\n\r\n    const res = await fetch(fullUrl, opts);\r\n    if (res.ok) {\r\n        console.log(\"response okay\");\r\n        //need to get html updates from json response\r\n        const resText = await res.text();\r\n        const rawJson = resText.replace(\"for (;;);\", \"\");\r\n        const postsJson = JSON.parse(rawJson);\r\n        const rawHtml = postsJson.domops[0][3].__html;\r\n        //construct doc from raw html string and get post wrapper elements into html collection\r\n        const postsDoc = document.createElement('html');\r\n        postsDoc.innerHTML = rawHtml;\r\n        //get posts elements from html doc\r\n        const postWrappers = postsDoc.getElementsByClassName(\"_5pcr userContentWrapper\");\r\n        //const postMessages = postsDoc.querySelectorAll(\"div[data-testid='post_message']\");\r\n\r\n        console.log(\"how many post containers: \", postWrappers.length)\r\n        for (let i = 0; i < postWrappers.length; i++) {\r\n            let post = {user: '', timestamp: '', text: [], images: [], video};\r\n            const postImages = postWrappers[i].getElementsByTagName('img');\r\n            const postParagraphs = postWrappers[i].getElementsByTagName('p');\r\n\r\n            //get username name, timestamp from post\r\n            const usernameWrapper = postWrappers[i].getElementsByClassName('fwb').item(0);\r\n            const username = usernameWrapper.textContent;\r\n            post.user = username;\r\n            const timestamp = postWrappers[i].getElementsByClassName('timestampContent')[0].textContent;\r\n            post.timestamp = timestamp;\r\n\r\n            //if post has paragraphs, iterate over each and push to text array in post object\r\n            for (let j = 0; j < postParagraphs.length; j++) {\r\n                post.text.push(postParagraphs[j].textContent);\r\n            }\r\n            //if post has images, iterate over each and push to image array in post object\r\n            if (postImages.length > 0) {\r\n                for (let k = 0; k < postImages.length; k++) {\r\n                    const image = postImages.item(k);\r\n                    const imagesToIgnore = \"Image may contain: possible text that says 'Shop Now'\";\r\n                    if (image.getAttribute('alt') !== imagesToIgnore) {\r\n                        post.images.push(image.getAttribute('src'));\r\n                    }\r\n                }\r\n            }\r\n            //if post has a video, grab source and set video property in post object\r\n            const postHasVideo = postsDoc.querySelectorAll(\"a[aria-label~='Video,']\");\r\n            if(postHasVideo.length > 0){\r\n                const videoSource = postHasVideo[0].attributes.ajaxify.value;\r\n                const videoUrl = \"https://www.facebook.com\" + videoSource;\r\n                post.video = (videoUrl)\r\n            }\r\n            postsArray.push(post);\r\n        }\r\n        return postsArray\r\n    } else {\r\n        console.log(\"response failed\");\r\n        return []\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}